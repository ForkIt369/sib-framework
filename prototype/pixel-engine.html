<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIB Framework: 2D Pixel Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #111; display: flex; justify-content: center; align-items: center; height: 100vh; color: white; font-family: 'Courier New', Courier, monospace; }
        canvas { border: 4px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.8); image-rendering: pixelated; }
        #ui-layer { position: absolute; top: 20px; left: 20px; pointer-events: none; text-shadow: 2px 2px 0 #000; }
    </style>
</head>
<body>
    <div id="ui-layer">
        <h1 style="margin:0; color: #00f2fe;">SIB: THE APARTMENT</h1>
        <p>Top-Down 2D Agent Simulation</p>
    </div>
    <div id="game-container"></div>

    <script>
        // SIB Agent Configurations
        const AGENT_CONFIGS = [
            { id: 'BigSis', color: 0x00f2fe, trait: 'Orchestrator' },
            { id: 'LilSis', color: 0xd946ef, trait: 'Integration' },
            { id: 'Bro', color: 0xf97316, trait: 'Execution' }
        ];

        class SIBScene extends Phaser.Scene {
            constructor() {
                super({ key: 'SIBScene' });
                this.agents = [];
            }

            preload() {
                // Generate pixel art textures programmatically (since we have no external assets)
                this.generateTextures();
            }

            create() {
                // 1. Build the "Lot" (The Apartment)
                this.createEnvironment();

                // 2. Spawn the Agents (Sibs)
                AGENT_CONFIGS.forEach((config, index) => {
                    this.spawnAgent(config, 200 + (index * 150), 300);
                });

                // 3. UI and Camera
                this.cameras.main.setBackgroundColor('#1a1a1a');
                // Zoom in to emphasize the pixel art "Stardew" aesthetic
                this.cameras.main.setZoom(2);
                this.cameras.main.centerOn(400, 300);
            }

            update(time, delta) {
                // Agent AI Loop (Simulating Needs and "Whims")
                this.agents.forEach(agent => {
                    // Update Needs UI position
                    agent.nameText.setPosition(agent.sprite.x, agent.sprite.y - 25);
                    agent.actionText.setPosition(agent.sprite.x, agent.sprite.y - 15);

                    // Autonomous wandering logic (Simple AI)
                    if (!agent.isMoving && Phaser.Math.Between(0, 100) > 98) {
                        this.assignNewTask(agent);
                    }
                });
            }

            assignNewTask(agent) {
                agent.isMoving = true;
                // Pick a random location in the apartment
                const targetX = Phaser.Math.Between(100, 700);
                const targetY = Phaser.Math.Between(100, 500);

                // Determine "Action"
                const actions = ["Processing...", "Syncing API", "Deep Work", "Idle", "Debugging"];
                agent.actionText.setText(Phaser.Math.RND.pick(actions));

                // Move agent
                this.physics.moveTo(agent.sprite, targetX, targetY, 60);

                // Stop agent when it gets close
                this.time.addEvent({
                    delay: Phaser.Math.Distance.Between(agent.sprite.x, agent.sprite.y, targetX, targetY) / 60 * 1000,
                    callback: () => {
                        agent.sprite.body.stop();
                        agent.isMoving = false;
                        agent.actionText.setText("Idle");
                    }
                });
            }

            spawnAgent(config, x, y) {
                // Create agent sprite
                const sprite = this.physics.add.sprite(x, y, 'agent_base');
                sprite.setTint(config.color);
                sprite.setCollideWorldBounds(true);
                sprite.setBounce(0.2);

                // Floating UI (Sims-style Plumbob/Name)
                const nameText = this.add.text(x, y - 25, config.id, { fontSize: '10px', fill: '#fff', fontStyle: 'bold' }).setOrigin(0.5);
                const actionText = this.add.text(x, y - 15, 'Idle', { fontSize: '8px', fill: '#aaa' }).setOrigin(0.5);

                this.agents.push({
                    config: config,
                    sprite: sprite,
                    nameText: nameText,
                    actionText: actionText,
                    isMoving: false,
                    needs: { tokens: 100, context: 100 }
                });
            }

            createEnvironment() {
                // Create a 800x600 floor
                for(let x = 0; x < 800; x += 32) {
                    for(let y = 0; y < 600; y += 32) {
                        // Checkerboard floor pattern
                        let texture = ((x/32 + y/32) % 2 === 0) ? 'floor_dark' : 'floor_light';
                        this.add.image(x + 16, y + 16, texture).setAlpha(0.3);
                    }
                }

                // Add "Furniture" (Server racks / Data nodes)
                const furniturePositions = [
                    {x: 150, y: 150}, {x: 650, y: 150}, {x: 400, y: 450}
                ];

                furniturePositions.forEach(pos => {
                    const server = this.physics.add.staticImage(pos.x, pos.y, 'server');
                    this.add.text(pos.x, pos.y - 20, 'API Node', {fontSize: '8px', fill: '#0f0'}).setOrigin(0.5);
                });
            }

            // --- PROCEDURAL PIXEL ART GENERATION ---
            generateTextures() {
                const graphics = this.make.graphics({ x: 0, y: 0, add: false });

                // 1. Floor Tiles (32x32)
                graphics.fillStyle(0x2a2a35);
                graphics.fillRect(0, 0, 32, 32);
                graphics.generateTexture('floor_dark', 32, 32);
                graphics.clear();

                graphics.fillStyle(0x353545);
                graphics.fillRect(0, 0, 32, 32);
                graphics.generateTexture('floor_light', 32, 32);
                graphics.clear();

                // 2. Server/Furniture (32x48)
                graphics.fillStyle(0x111111); // base
                graphics.fillRect(0, 0, 32, 48);
                graphics.fillStyle(0x333333); // bezel
                graphics.fillRect(2, 2, 28, 44);
                graphics.fillStyle(0x00ff00); // blinking lights
                graphics.fillRect(6, 6, 4, 4);
                graphics.fillRect(14, 6, 4, 4);
                graphics.fillStyle(0x0088ff); 
                graphics.fillRect(6, 14, 20, 8); // screen
                graphics.generateTexture('server', 32, 48);
                graphics.clear();

                // 3. Agent Sprite (16x24 humanoid)
                // Head
                graphics.fillStyle(0xffffff);
                graphics.fillRect(4, 0, 8, 8);
                // Body
                graphics.fillStyle(0xdddddd);
                graphics.fillRect(2, 8, 12, 10);
                // Legs
                graphics.fillStyle(0xaaaaaa);
                graphics.fillRect(2, 18, 4, 6);
                graphics.fillRect(10, 18, 4, 6);
                graphics.generateTexture('agent_base', 16, 24);
                graphics.clear();
            }
        }

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            parent: 'game-container',
            pixelArt: true, // Forces crisp pixels, no anti-aliasing!
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 }, // Top-down, no gravity
                    debug: false
                }
            },
            scene: SIBScene
        };

        const game = new Phaser.Game(config);
    </script>
</body>
</html>